# Cerberus Configuration
# Multi-agent AI code review system
version: 1

name: "Cerberus"
required_check: "Cerberus / Verdict"
mode: parallel                      # parallel | sequential
cancel_in_progress: true            # Cancel stale runs on new push

model:
  default: "openrouter/moonshotai/kimi-k2.5"
  fallback:
    - "openrouter/google/gemini-3-flash-preview"
    - "openrouter/z-ai/glm-5"
  wave_pools:
    wave1:
      - "openrouter/moonshotai/kimi-k2.5"
      - "openrouter/x-ai/grok-4.1-fast"
      - "openrouter/minimax/minimax-m2.5"
      - "openrouter/google/gemini-3-flash-preview"
    wave2:
      - "openrouter/moonshotai/kimi-k2.5"
      - "openrouter/z-ai/glm-5"
      - "openrouter/anthropic/claude-haiku-4.5"
      - "openrouter/google/gemini-3-flash-preview"
      - "openrouter/minimax/minimax-m2.5"
    wave3:
      - "openrouter/openai/gpt-5.3-codex"
      - "openrouter/google/gemini-3.1-pro-preview"
      - "openrouter/anthropic/claude-sonnet-4.6"
  pool:
    - "openrouter/moonshotai/kimi-k2.5"
    - "openrouter/x-ai/grok-4.1-fast"
    - "openrouter/minimax/minimax-m2.5"
    - "openrouter/google/gemini-3-flash-preview"
    - "openrouter/anthropic/claude-haiku-4.5"
    - "openrouter/z-ai/glm-5"
    - "openrouter/openai/gpt-5.3-codex"
    - "openrouter/google/gemini-3.1-pro-preview"
    - "openrouter/anthropic/claude-sonnet-4.6"
  tiers:
    flash:
      - "openrouter/moonshotai/kimi-k2.5"
      - "openrouter/x-ai/grok-4.1-fast"
      - "openrouter/google/gemini-3-flash-preview"
      - "openrouter/minimax/minimax-m2.5"
    standard:
      - "openrouter/moonshotai/kimi-k2.5"
      - "openrouter/z-ai/glm-5"
      - "openrouter/anthropic/claude-haiku-4.5"
      - "openrouter/minimax/minimax-m2.5"
      - "openrouter/google/gemini-3-flash-preview"
    pro:
      - "openrouter/openai/gpt-5.3-codex"
      - "openrouter/google/gemini-3.1-pro-preview"
      - "openrouter/anthropic/claude-sonnet-4.6"
      - "openrouter/z-ai/glm-5"
      - "openrouter/minimax/minimax-m2.5"
      - "openrouter/google/gemini-3-flash-preview"
  cli: pi
  thinking: true
  max_steps: 25                       # Max agentic steps per reviewer
  timeout: 600                        # Seconds per reviewer

waves:
  enabled: true
  order:
    - wave1
    - wave2
    - wave3
  max_for_tier:
    flash: 2      # docs-only PRs stop at wave2
    standard: 3
    pro: 3
  gate:
    block_on_critical: true
    block_on_major: true
    block_on_skip: true
    skip_tolerance: 1           # allow up to 1 skip per wave before blocking (3-reviewer pools)
  definitions:
    wave1:                            # "Does it work and is it safe?" — flash models
      reviewers:
        - trace
        - guard
        - proof
    wave2:                            # "Is it well-designed?" — standard models
      reviewers:
        - atlas
        - fuse
        - craft
    wave3:                            # "Deep audit of highest stakes" — pro models
      reviewers:
        - trace
        - guard
        - atlas

routing:
  enabled: false  # waves have fixed reviewer assignments; LLM routing not needed
  model: "openrouter/google/gemini-3-flash-preview"
  panel_size: 3
  always_include:
    - trace      # correctness always runs
  include_if_code_changed:
    - guard      # security runs if non-test/non-doc code changed
  fallback_panel:
    - trace
    - atlas
    - guard

override:
  enabled: true
  command: "/cerberus override"
  actor: pr_author                    # pr_author | write_access | maintainers_only
  require_reason: true
  pin_to_sha: true

# Verdict rules
verdict:
  fail_on: "any_critical_or_2_major"  # any_critical | any_critical_or_2_major | any_major
  warn_on: "any_major_or_5_minor_or_3_minor_same_category"  # any_major | any_major_or_5_minor_or_3_minor_same_category
  confidence_min: 0.7

cerberus_verdict:
  fail_on: "any_critical_fail_or_2_fails"  # single non-critical FAIL is downgraded to WARN

# The eight reviewers of Cerberus.
# Names are codenames — perspective determines behavior.
reviewers:
  - name: trace
    perspective: correctness
    model: pool
    description: "Correctness — Find the bug"
    override: pr_author
    tools:
      shell: false

  - name: atlas
    perspective: architecture
    model: pool
    description: "Architecture — Zoom out"
    override: pr_author
    tools:
      shell: false

  - name: guard
    perspective: security
    model: pool
    description: "Security — Think like an attacker"
    override: maintainers_only
    tools:
      shell: false

  - name: craft
    perspective: maintainability
    model: pool
    description: "Maintainability — Think like the next dev"
    override: pr_author
    tools:
      shell: false

  - name: proof
    perspective: testing
    model: pool
    description: "Testing — See what will break"
    override: pr_author
    tools:
      shell: false

  - name: fuse
    perspective: resilience
    model: pool
    description: "Resilience — What happens when the happy path fails"
    override: pr_author
    tools:
      shell: false

